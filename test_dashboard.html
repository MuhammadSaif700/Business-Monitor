<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Test</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Dashboard API Test</h1>
    <div id="results"></div>
    
    <script>
        const api = axios.create({ 
            baseURL: 'http://localhost:8000',
            headers: {
                'X-API-Key': 'demoapikey'
            }
        });
        
        async function testDashboard() {
            const results = document.getElementById('results');
            
            try {
                console.log('Testing datasets endpoint...');
                const datasetsRes = await api.get('/datasets');
                console.log('Datasets:', datasetsRes.data);
                
                if (datasetsRes.data.datasets && datasetsRes.data.datasets.length > 0) {
                    const tableName = datasetsRes.data.datasets[0].table_name;
                    console.log('Testing smart dashboard with table:', tableName);
                    
                    const smartRes = await api.post('/analytics/smart-dashboard', {
                        table_name: tableName
                    });
                    console.log('Smart Dashboard Response:', smartRes.data);
                    
                    results.innerHTML = `
                        <h3>Success!</h3>
                        <p><strong>Dataset:</strong> ${tableName}</p>
                        <p><strong>KPIs Count:</strong> ${smartRes.data.kpis ? smartRes.data.kpis.length : 0}</p>
                        <p><strong>Charts Count:</strong> ${smartRes.data.charts ? smartRes.data.charts.length : 0}</p>
                        <pre>${JSON.stringify(smartRes.data, null, 2)}</pre>
                    `;
                } else {
                    results.innerHTML = '<p>No datasets found</p>';
                }
                
            } catch (error) {
                console.error('Error:', error);
                results.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
                if (error.response) {
                    results.innerHTML += `<p>Status: ${error.response.status}</p>`;
                    results.innerHTML += `<pre>${JSON.stringify(error.response.data, null, 2)}</pre>`;
                }
            }
        }
        
        // Test on page load
        testDashboard();
    </script>
</body>
</html>